<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Patch Registry API Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .success {
        background: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background: #d1ecf1;
        border-color: #bee5eb;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        cursor: pointer;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>üîß Patch Registry API Test</h1>

    <div class="test-section info">
      <h3>üìã Test Instructions</h3>
      <p>
        Click the buttons below to test each API endpoint. Check the results to
        see if the APIs are working correctly.
      </p>
    </div>

    <div class="test-section">
      <h3>üìä Test Statistics API</h3>
      <button onclick="testStatistics()">
        Test /api/patch-registry/statistics
      </button>
      <div id="statistics-result"></div>
    </div>

    <div class="test-section">
      <h3>üö® Test Alerts API</h3>
      <button onclick="testAlerts()">Test /api/patch-registry/alerts</button>
      <div id="alerts-result"></div>
    </div>

    <div class="test-section">
      <h3>üîç Test Check Updates API</h3>
      <button onclick="testCheckUpdates()">
        Test /api/patch-registry/check-updates
      </button>
      <div id="check-result"></div>
    </div>

    <div class="test-section">
      <h3>üåê Test Server Connection</h3>
      <button onclick="testServer()">Test Server Health</button>
      <div id="server-result"></div>
    </div>

    <script>
      const API_BASE = "/api";

      async function testStatistics() {
        const resultDiv = document.getElementById("statistics-result");
        resultDiv.innerHTML = "<p>Testing...</p>";

        try {
          const response = await fetch(`${API_BASE}/patch-registry/statistics`);
          const data = await response.json();

          if (data.success) {
            resultDiv.className = "test-section success";
            resultDiv.innerHTML = `
                        <h4>‚úÖ Statistics API Working</h4>
                        <pre>${JSON.stringify(data.data, null, 2)}</pre>
                    `;
          } else {
            resultDiv.className = "test-section error";
            resultDiv.innerHTML = `
                        <h4>‚ùå Statistics API Error</h4>
                        <p>Error: ${data.message}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (error) {
          resultDiv.className = "test-section error";
          resultDiv.innerHTML = `
                    <h4>‚ùå Network Error</h4>
                    <p>Error: ${error.message}</p>
                `;
        }
      }

      async function testAlerts() {
        const resultDiv = document.getElementById("alerts-result");
        resultDiv.innerHTML = "<p>Testing...</p>";

        try {
          const response = await fetch(`${API_BASE}/patch-registry/alerts`);
          const data = await response.json();

          if (data.success) {
            resultDiv.className = "test-section success";
            resultDiv.innerHTML = `
                        <h4>‚úÖ Alerts API Working</h4>
                        <p>Found ${data.data.length} alerts</p>
                        <pre>${JSON.stringify(
                          data.data.slice(0, 3),
                          null,
                          2
                        )}</pre>
                        ${
                          data.data.length > 3
                            ? `<p>... and ${data.data.length - 3} more</p>`
                            : ""
                        }
                    `;
          } else {
            resultDiv.className = "test-section error";
            resultDiv.innerHTML = `
                        <h4>‚ùå Alerts API Error</h4>
                        <p>Error: ${data.message}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (error) {
          resultDiv.className = "test-section error";
          resultDiv.innerHTML = `
                    <h4>‚ùå Network Error</h4>
                    <p>Error: ${error.message}</p>
                `;
        }
      }

      async function testCheckUpdates() {
        const resultDiv = document.getElementById("check-result");
        resultDiv.innerHTML = "<p>Testing...</p>";

        try {
          const response = await fetch(
            `${API_BASE}/patch-registry/check-updates`,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
            }
          );
          const data = await response.json();

          if (data.success) {
            resultDiv.className = "test-section success";
            resultDiv.innerHTML = `
                        <h4>‚úÖ Check Updates API Working</h4>
                        <p>${data.message}</p>
                        <pre>${JSON.stringify(data.data, null, 2)}</pre>
                    `;
          } else {
            resultDiv.className = "test-section error";
            resultDiv.innerHTML = `
                        <h4>‚ùå Check Updates API Error</h4>
                        <p>Error: ${data.message}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
          }
        } catch (error) {
          resultDiv.className = "test-section error";
          resultDiv.innerHTML = `
                    <h4>‚ùå Network Error</h4>
                    <p>Error: ${error.message}</p>
                `;
        }
      }

      async function testServer() {
        const resultDiv = document.getElementById("server-result");
        resultDiv.innerHTML = "<p>Testing...</p>";

        try {
          const response = await fetch("/");
          if (response.ok) {
            resultDiv.className = "test-section success";
            resultDiv.innerHTML = `
                        <h4>‚úÖ Server is Running</h4>
                        <p>Status: ${response.status} ${response.statusText}</p>
                    `;
          } else {
            resultDiv.className = "test-section error";
            resultDiv.innerHTML = `
                        <h4>‚ùå Server Error</h4>
                        <p>Status: ${response.status} ${response.statusText}</p>
                    `;
          }
        } catch (error) {
          resultDiv.className = "test-section error";
          resultDiv.innerHTML = `
                    <h4>‚ùå Server Not Reachable</h4>
                    <p>Error: ${error.message}</p>
                    <p>Make sure the server is running on port 3000</p>
                `;
        }
      }
    </script>
  </body>
</html>
